# Django Music

Django-приложение (т.е. веб-приложение) для работы с базой данных MySQL «Музыка».

Дипломный проект по курсу «Python-разработчик».

Цель проекта: реализация веб-приложения на языке Python для работы с ранее разработанной в СУБД MySQL базой данных.

Задачи, выполняемые приложением:

* просмотр данных (с возможностью обычного копирования текста),
* поиск по любому из полей,
* добавление данных,
* изменение данных,
* удаление данных,
* защита от удаления записей, от которых зависят другие данные.

## Установка

1. Установите СУБД MySQL 8 и создайте сервер с учётной записью.

   Разработка велась на версии 8.0.33.
   Актуальную версию 8.0.xx можно скачать по ссылке:

   `https://dev.mysql.com/downloads/mysql/`

2. Клонируйте проект из репозитория:
   ```bash
   git clone https://github.com/OrlandV/diplomMusic.git
   ```

3. Создайте базу данных.
   * Используйте файл `diplomMusic/django_music2_create.sql`.
   * Либо используйте модель из файла `diplomMusic/django_music2_model.mwb`, импортировав её в СУБД и выполнив команду меню `Database → Forward Engineer…` → `Next` в окне мастера.

   Должна создастся база данных `django_music2`.

4. Установите Django и клиент MySQL:
   ```bash
   pip install Django==5.1.2 mysqlclient==2.2.5
   ```

5. Исправьте в конфигурации подключения к базе данных в файле `diplomMusic/djangoMusic/music/config_db.py` логин и пароль на свои.
    ```python
    db_connect = {
        'ENGINE': 'django.db.backends.mysql',
        'NAME': 'django_music2',
        'USER': 'login',  # Здесь укажите свой логин.
        'PASSWORD': 'password',  # Здесь укажите свой пароль.
        'HOST': 'localhost',
        'PORT': '3306',
    }
    ```

6. Перейдите в папку приложения и запустите его:
   ```bash
   cd diplomMusic/djangoMusic
   python manage.py runserver
   ```

   Приложение будет доступно по адресу `http://localhost:8000`.

## Использование

По корневому адресу `/` расположена только ссылка на приложение. Эту ссылку можете вставить в свой проект, к которому подключите приложение.

Перейдите по ссылке на приложение.

`music/`

### Главная страница приложения — Поиск

Заголовок `БД «Музыка»`, присутствующий на всех страницах приложения, является ссылкой на страницу «Поиск». 

Страница поиска разделена на две части.

#### 1. В верхней части отображается результат поиска.
	
При переходе на страницу без параметров, отобразится всё содержимое базы данных с постраничной навигацией (пагинацией) по 10 строк в виде таблицы.
  
Кликнув на заголовок колонки, Вы можете сортировать таблицу.
  
Под таблицей под пагинацией расположено три блока:
  
* Форма «Порядок множественной сортировки»
  
  Позволяет сортировать по нескольким колонкам в произвольном порядке.

* Форма «Количество отображаемых записей на странице»
  
  Позволяет управлять количеством строк таблицы на странице.

* Ссылки на следующие страницы-разделы приложения

  На странице поиска в этом блоке находится только ссылка «Добавить трек».

Если в базе данных нет данных или поиск выдал пустой результат, вместо таблицы с пагинацией и двух форм отобразится уведомление «Нет данных».

#### 2. В нижней части расположена форма поиска.

Можете искать по одному полю или по нескольким полям. При поиске по нескольким полям результаты обобщаются. Срабатывает принцип «Найди хоть что-то с этим».
  
Для поиска по принципу «Найди только то, где есть сразу всё указанное» нужно внизу формы включить выключатель «Строгий режим».

### Добавление трека

Верхняя часть страницы — таблица «Треки».

Нижняя часть — форма «Добавление трека».

По ссылкам в блоке «Добавить» можно перейти на страницы:

* Добавление автора
  
  Автор — сущность базы данных, содержащая ФИО авторов и исполнителей.

* Добавление альбома

* Добавление в «Музыка из»
  
  Музыка из — сущность базы данных, содержащая фильмы и спектакли (мюзиклы), в которых официально использовались треки. (В будущем планирую заменить это название на более подходящее.)

Прежде чем добавить трек, нужно добавить авторов и альбом — обязательные поля для заполнения в форме «Добавление трека».


### Добавление автора

Верхняя часть страницы — таблица «Авторы».

Нижняя часть — форма «Добавление автора».

Внизу формы есть кнопка «Назад» для возврата на страницу «Добавление трека».

### Добавление в «Музыка из»

Верхняя часть страницы — таблица «Музыка из».

Нижняя часть — форма „Добавление в «Музыка из»“.

Внизу формы есть кнопка «Назад» для возврата на страницу «Добавление трека».

### Добавление альбома

Верхняя часть страницы — таблица «Альбомы».

Нижняя часть — форма «Добавление альбома».

Внизу формы есть кнопка «Назад» для возврата на страницу «Добавление трека».

По ссылкам в блоке «Добавить» можно перейти на страницы:

* Добавление медиа-формата

* Добавление лейбла

* Добавление изготовителя

Прежде чем добавить альбом, нужно добавить медиа-формат — обязательное поле для заполнения в форме «Добавление альбома».

### Добавление медиа-формата

Верхняя часть страницы — таблица «Медиа-форматы».

Нижняя часть — форма «Добавление медиа-формата».

Внизу формы есть кнопка «Назад» для возврата на страницу «Добавление альбома».

### Добавление лейбла

Верхняя часть страницы — таблица «Лейблы».

Нижняя часть — форма «Добавление лейбла».

Внизу формы есть кнопка «Назад» для возврата на страницу «Добавление альбома».

### Добавление изготовителя

Верхняя часть страницы — таблица «Изготовители».

Нижняя часть — форма «Добавление изготовителя».

Внизу формы есть кнопка «Назад» для возврата на страницу «Добавление альбома».

### Изменение и удаление записей

В каждой таблице в последней колонке (безымянной) расположены ссылки на страницы правки и удаления соответствующей записи.

Перед непосредственным удалением будут выведены данные об удаляемой записи и кнопка для подтверждения удаления.

Если обнаружатся связи с другими сущностями базы данных, на той же странице удаления будет выведена информация о найденных связях.

Трек можно удалить, даже если он связан с другими сущностями, так как от него нет зависимостей. Наоборот, это он зависит от всех остальных.

Если попытаетесь удалить альбом, от которого зависит хотябы один трек, то отобразится этот трек, а кнопка подтверждения удаления не отобразится.

## Использование приложением COOKIE

Для запоминания параметров сортировки и пагинации приложение использует COOKIE.
Эти параметры используются для возврата через кнопку «Назад».

## Обработка ошибок ввода

Текстовые поля имеют справой стороны примечания о максимальной длине строки. Если пользователь превысил эту длину и нажал на кнопку «OK», то останется на этой же странице и увидит сообщение об ошибке.

## Зависимости

- Django 5.1.2
- mysqlclient 2.2.5

---

Разработчик Орлов Андрей.
